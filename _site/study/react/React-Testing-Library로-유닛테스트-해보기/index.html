<!DOCTYPE html>
<html>
  <head>
    <title>maruzzing's devlog</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="/style.css"
    />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="maruzzing's devlog - "
      href="/feed.xml"
    />
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"
            ><img src="/images/logo.png"
          /></a>

          <div class="site-info">
            <p class="site-name">
              <a href="/">maruzzing's devlog</a>
            </p>
          </div>
          <nav>
             
            <span class="active">
              <a href="/study">개발공부</a>
            </span>
             
            <span class="">
              <a href="/project">프로젝트</a>
            </span>
            
            <img
              src="/images/vertical_line.png"
              class="vertical_line"
            />
            <a href="mailto:lidiach217@gmail.com">
              <img
                src="/images/email_icon.png"
                class="email_icon"
            /></a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main">
      
<div>
  <div class="sidebars">
  
  <ul>
    
    <li class="sidebar">
      <a href="/study">개발공부</a>
    </li>
      
    <li class="sidebar">
      <a href="/study/computerscience">컴퓨터 공학</a>
    </li>
     
    <li class="sidebar">
      <a href="/study/javascript">Javascript</a>
    </li>
     
    <li class="sidebar">
      <a href="/study/nodejs">Node.js</a>
    </li>
     
    <li class="sidebar">
      <a href="/study/graphql">GraphQL</a>
    </li>
     
    <li class="sidebar">
      <a href="/study/nextjs">Next.js</a>
    </li>
     
    <li class="sidebar">
      <a href="/study/react" class="activated">
        React
      </a>
    </li>
     
    <li class="sidebar">
      <a href="/study/rnative">React Native</a>
    </li>
     
    <li class="sidebar">
      <a href="/study/py">Python</a>
    </li>
     
    <li class="sidebar">
      <a href="/study/algorithm">Algorithm</a>
    </li>
     
    <li class="sidebar">
      <a href="/study/etc">기타</a>
    </li>
    
  </ul>
</div>

</div>
 
<div class="container">
  <article class="post">
    <button onclick="topFunction()" id="myBtn" style="display:none">
  <img
    id="btn_img"
    src="/images/back-to-top-icon-png-28.png"
  />
</button>

<script>
  //Get the button
  var mybutton = document.getElementById("myBtn");

  // When the user scrolls down 20px from the top of the document, show the button
  window.onscroll = function() {
    scrollFunction();
  };

  function scrollFunction() {
    if (
      document.body.scrollTop > 20 ||
      document.documentElement.scrollTop > 20
    ) {
      mybutton.style.display = "block";
    } else {
      mybutton.style.display = "none";
    }
    // if (
    //   document.body.scrollBottom < 20 ||
    //   document.documentElement.scrollBottom < 20
    // ) {
    //   mybutton.style.bottom = "160px";
    // }
  }

  // When the user clicks on the button, scroll to the top of the document
  function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
  }
</script>

    <h1>React Testing Library로 유닛테스트 해보기</h1>
    <div class="date">Written on September 29, 2019</div>
    <div class="entry">
      <p>처음 개발을 배울 때 테스트 주도 개발이 대세라는 이야기를 들었을 때 ‘코드를 테스트 하기 위해 또 다른 코드를 작성해야 한다고?’ 하며 겁먹었던 기억이 난다 ㅎㅎ 그런데 공부를 하다보니 조금 더 깔끔한 코드, 효율적인 코드에 대해 고민하게 되고 이참에 테스트에 대해 공부해 보기로 했다.</p>

<p>특히나 내가 주로 사용하는 Javascript는 동적 타입언어인 데다가 코드 문제를 즉시 확인해주는 컴파일러가 없기 때문에 실행하기 전에 오류를 발견하기 어렵고, 발견 하더라도 버그 발견 시점이 코드 구현 시점에서 멀어질수록 원인을 찾기 어렵다. 💦</p>

<p><img src="/images/react-testing-library.png" alt="react-testing-library" title="react-testing-library" /></p>

<p>많은 테스트 프레임워크나 라이브러리가 있지만 <a href="https://jestjs.io/">Jest</a>나 <a href="https://airbnb.io/enzyme/">Enzyme</a>를 많이 사용한다고 한다.하지만! <a href="https://github.com/testing-library/react-testing-library">React Testing Library</a>를 사용해 보기로… 그 이유는 React Testing Library가 사용자가 이용하는 관점에서 테스트를 하는 <strong>Behavior Driven Test(행위 주도 테스트)</strong>를 작성하기에 적합하기 때문이다.</p>

<h2 id="라이브러리-설치-및-설정">라이브러리 설치 및 설정</h2>

<p>먼저 <a href="https://github.com/testing-library/react-testing-library">React Testing Library</a>와 <a href="https://github.com/testing-library/jest-dom">jest-dom</a>을 설치한다. React Testing Library는 실제 브라우저 DOM을 기준으로 테스트를 진행하기 때문에 jest-dom을 설치하는 것이다.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">--save-dev</span> @testing-library/react
npm <span class="nb">install</span> <span class="nt">--save-dev</span> @testing-library/jest-dom
</code></pre></div></div>

<p>그리고 <code class="highlighter-rouge">src/setupTests.js</code> 파일에 아래 두 가지를 추가한다. 첫 번째 라인은 각 테스트가 끝날 때 마다 jest-dom에 렌더링된 내용을 지우게 하는 것이다. 두 번째 라인은 jest-dom이 제공하는 테스팅 <a href="https://github.com/testing-library/jest-dom#table-of-contents">matcher</a>들이 있는데, 이것을 jest test 러너가 불러올 수 있게 하는 것이다.</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">"</span><span class="s2">@testing-library/react/cleanup-after-each</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">@testing-library/jest-dom/extend-expect</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="테스트-코드-작성">테스트 코드 작성</h2>

<h3 id="react-testing-library-주요-api">React Testing Library 주요 API</h3>

<p>React Testing Library는 jest-dom에 테스트 하고 싶은 컴포넌트를 <code class="highlighter-rouge">render()</code>해서 그 DOM에 그려진 내용으로 테스트 하는 것이다. 렌더된 특정 텍스트나, 라벨로 DOM을 서치하는 <code class="highlighter-rouge">getByText</code>, <code class="highlighter-rouge">getByLabelText</code>, 등의 쿼리가 있고, 컴포넌트에 <code class="highlighter-rouge">data-testid</code>를 부여해 그 id로 확인하는 <code class="highlighter-rouge">getByTestId</code> 등의 쿼리가 있다. (<a href="https://testing-library.com/docs/dom-testing-library/cheatsheet">더 많은 쿼리 보기</a>) 또한, 동적 컴포넌트의 테스트를 위해 jest-dom에 액션을 주는 <code class="highlighter-rouge">fireEvent</code> API도 있다.</p>

<h3 id="정적-테스트-코트-작성">정적 테스트 코트 작성</h3>

<p>먼저, name을 입력할 수 있는 <code class="highlighter-rouge">Form</code> 컴포넌트를 만들고 렌더링된 정적인 화면을 테스트 해보자.</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/Form.js</span>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">Form</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">onSubmit</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">name</span><span class="p">,</span> <span class="nx">setName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="dl">""</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">handleSubmit</span> <span class="o">=</span> <span class="nx">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">onSubmit</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className=</span><span class="s2">"top"</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">form</span> <span class="na">onSubmit=</span><span class="si">{</span><span class="nx">handleSubmit</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>
          Name:
          <span class="p">&lt;</span><span class="nt">input</span>
            <span class="nt">data</span><span class="err">-</span><span class="na">testid=</span><span class="s2">"nameInput"</span>
            <span class="na">type=</span><span class="s2">"text"</span>
            <span class="na">name=</span><span class="s2">"name"</span>
            <span class="na">value=</span><span class="si">{</span><span class="nx">name</span><span class="si">}</span>
            <span class="na">onChange=</span><span class="si">{</span><span class="p">({</span> <span class="na">target</span><span class="p">:</span> <span class="p">{</span> <span class="nx">value</span> <span class="p">}</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="nx">setName</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="si">}</span>
          <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type=</span><span class="s2">"submit"</span> <span class="na">value=</span><span class="s2">"Submit"</span> <span class="na">disabled=</span><span class="si">{</span><span class="o">!</span><span class="nx">name</span><span class="si">}</span> <span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">Form</span><span class="p">;</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">Form</code> 컴포넌트가 위와 같을 때, 뷰가 제대로 그려졌는지 확인하기 위해서 아래와 같은 테스트 코드를 작성할 수 있다.</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/Form.test.js</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">render</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@testing-library/react</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Form</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Form</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;Form /&gt;</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">renders input</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">getByLabelText</span><span class="p">,</span> <span class="nx">getByText</span><span class="p">,</span> <span class="nx">getByTestId</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">render</span><span class="p">(&lt;</span><span class="nc">Form</span> <span class="p">/&gt;);</span>
    <span class="kd">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">getByLabelText</span><span class="p">(</span><span class="dl">"</span><span class="s2">Name:</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">getByTestId</span><span class="p">(</span><span class="dl">"</span><span class="s2">nameInput</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">getByText</span><span class="p">(</span><span class="dl">"</span><span class="s2">Submit</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">input</span><span class="p">).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">button</span><span class="p">).</span><span class="nx">toBeInTheDocument</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="동적-테스트-코트-작성">동적 테스트 코트 작성</h3>

<p>이제 액션이 일어났을 때의 테스트를 작성해 보자. <a href="https://testing-library.com/docs/dom-testing-library/api-events"><code class="highlighter-rouge">fireEvent</code></a>로 액션을 실행할 수 있는데 <code class="highlighter-rouge">fireEvent(node: HTMLElement, event: Event)</code> 형태와 <code class="highlighter-rouge">fireEvent[eventName](node: HTMLElement, eventProperties: Object)</code> 형태로 사용할 수 있다.</p>

<p>아무것도 입력하지 않았을 때는 submit 버튼이 disabled였다가, name이 입력되면 enabled로 바뀌는 테스트 코드는 아래와 같이 작성할 수 있다.</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/Form.test.js</span>
<span class="p">...</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">render</span><span class="p">,</span> <span class="nx">fireEvent</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@testing-library/react</span><span class="dl">"</span><span class="p">;</span>
<span class="p">...</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;Form /&gt;</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="p">...</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">enables button when name entered</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">getByLabelText</span><span class="p">,</span> <span class="nx">getByText</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">render</span><span class="p">(&lt;</span><span class="nc">Form</span> <span class="p">/&gt;);</span>
    <span class="kd">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">getByLabelText</span><span class="p">(</span><span class="dl">"</span><span class="s2">Name:</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">getByText</span><span class="p">(</span><span class="dl">"</span><span class="s2">Submit</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">button</span><span class="p">).</span><span class="nx">toBeDisabled</span><span class="p">();</span>
    <span class="nx">fireEvent</span><span class="p">.</span><span class="nx">change</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="p">{</span> <span class="na">target</span><span class="p">:</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="dl">"</span><span class="s2">maruzzing</span><span class="dl">"</span> <span class="p">}</span> <span class="p">});</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">button</span><span class="p">).</span><span class="nx">toBeEnabled</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>그리고 submit을 눌렀을 때 <code class="highlighter-rouge">onSubmit</code> 함수가 실행되는 것을 확인하는 코드는 아래와 같이 작성할 수 있다.</p>

<div class="language-react highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// src/Form.test.js</span>
<span class="p">...</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;Form /&gt;</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="p">...</span>
  <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">submits form when buttion is clicked</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">onSubmit</span> <span class="o">=</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">();</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">getByLabelText</span><span class="p">,</span> <span class="nx">getByText</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">render</span><span class="p">(&lt;</span><span class="nc">Form</span> <span class="na">onSubmit=</span><span class="si">{</span><span class="nx">onSubmit</span><span class="si">}</span> <span class="p">/&gt;);</span>
    <span class="kd">const</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">getByLabelText</span><span class="p">(</span><span class="dl">"</span><span class="s2">Name:</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">getByText</span><span class="p">(</span><span class="dl">"</span><span class="s2">Submit</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">fireEvent</span><span class="p">.</span><span class="nx">change</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="p">{</span> <span class="na">target</span><span class="p">:</span> <span class="p">{</span> <span class="na">value</span><span class="p">:</span> <span class="dl">"</span><span class="s2">maruzzing</span><span class="dl">"</span> <span class="p">}</span> <span class="p">});</span>
    <span class="nx">fireEvent</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">button</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">onSubmit</span><span class="p">).</span><span class="nx">toHaveBeenCalledTimes</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>완전신기 !! 테스트에 초록불이 켜졌을 때의 희열이란 !!! 🤩
조금 더 복잡한 컴포넌트의 test도 해 봐야 겠다!!</p>

<iframe src="https://codesandbox.io/embed/quizzical-khayyam-m9hnw?fontsize=14" title="react-test-library-ex" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>

    </div>
    
 
 
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'maruzzing-github-io';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

  </article>
</div>
</li>
    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          <span class="footer-name">© maruzzing, 2019</span>
        </footer>
      </div>
    </div>
    
<!-- Google Analytics -->
<script>
  (function(i, s, o, g, r, a, m) {
    i["GoogleAnalyticsObject"] = r;
    (i[r] =
      i[r] ||
      function() {
        (i[r].q = i[r].q || []).push(arguments);
      }),
      (i[r].l = 1 * new Date());
    (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m);
  })(
    window,
    document,
    "script",
    "//www.google-analytics.com/analytics.js",
    "ga"
  );

  ga("create", "UA-142529094-1", "auto");
  ga("send", "pageview", {
    'page': '/study/react/React-Testing-Library%EB%A1%9C-%EC%9C%A0%EB%8B%9B%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%95%B4%EB%B3%B4%EA%B8%B0/',
    'title': 'React Testing Library로 유닛테스트 해보기'
  });
</script>
<!-- End Google Analytics -->


  </body>
</html>
