I"d<p>ìš”ì¦˜ì€ ëŒ€ë¶€ë¶„ì˜ ì„œë¹„ìŠ¤ê°€ ìì²´ ì‚¬ì´íŠ¸ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ ë¿ë§Œ ì•„ë‹ˆë¼ êµ¬ê¸€, í˜ì´ìŠ¤ë¶ ë“± ê¸°ì¡´ ìœ ì €ê°€ ê°€ì§€ê³  ìˆë˜ ì–´ì¹´ìš´íŠ¸ë¥¼ í™œìš©í•˜ì—¬ ë¡œê·¸ì¸ í•˜ëŠ” ì†Œì…œë¡œê·¸ì¸ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤. í•œ ê°€ì§€ì˜ ì†Œì…œ ë¡œê·¸ì¸ë§Œ ì œê³µì„ í•œë‹¤ë©´ í•´ë‹¹ SNSì—ì„œ ì œê³µí•˜ëŠ” APIë¥¼ ì‚¬ìš©í•˜ë©´ ë˜ê² ì§€ë§Œ, ì—¬ëŸ¬ê°€ì§€ ë¡œê·¸ì¸ ë°©ë²•ì„ ì•±ì— íƒ‘ì¬í•˜ê³  ì‹¶ë‹¤ë©´ <strong><a href="https://github.com/jaredhanson/passport">Passport ëª¨ë“ˆ</a>ì„ í™œìš©</strong>í•˜ëŠ”ê²ƒì´ ì¢‹ë‹¤.</p>

<p>Passport ëª¨ë“ˆì€ ë‹¤ì–‘í•œ ì¸ì¦ APIë¥¼ ê°„í¸í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ëª¨ë“ˆë¡œ, user ì •ë³´ë¥¼ sessionì— ì €ì¥í•œë‹¤. í•˜ì§€ë§Œ JWTì„ ì‚¬ìš©í•˜ëŠ” ë™ì‹œì— sessionì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ë¶ˆí•„ìš”í•œ ì‘ì—…ì´ë‹¤. ë‹¤í–‰íˆë„ PassportëŠ” ì‚¬ìš©ì ì •ë³´ë¥¼ sessionì— ì €ì¥í•˜ëŠ” ëŒ€ì‹  requestì— ì €ì¥í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ìˆë‹¤.</p>

<p><strong>Express.js, passport, JWT, ê·¸ë¦¬ê³  React Nativeë¡œ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•</strong>ì´ì, ì‚½ì§ˆì˜ ê²°ê³¼ë¥¼ ì•„ë˜ì™€ ê°™ì€ ì‹œë¦¬ì¦ˆë¡œ í¬ìŠ¤íŒ… í•˜ê² ë‹¤.</p>

<ul>
  <li><a href="/study/nodejs/Passportì™€-JWTë¥¼-ì´ìš©í•˜ì—¬-Auth-êµ¬í˜„í•˜ê¸°-1/">Passportì™€ JWTë¥¼ ì´ìš©í•˜ì—¬ Auth êµ¬í˜„í•˜ê¸°[1]</a> - (server) ìì²´ íšŒì›ê°€ì…, ë¡œê·¸ì¸ ë° JWT</li>
  <li><a href="/study/nodejs/Passportì™€-JWTë¥¼-ì´ìš©í•˜ì—¬-Auth-êµ¬í˜„í•˜ê¸°-2/">Passportì™€ JWTë¥¼ ì´ìš©í•˜ì—¬ Auth êµ¬í˜„í•˜ê¸°[2]</a> - (server) ì†Œì…œë¡œê·¸ì¸</li>
  <li><a href="/study/rnative/Passportì™€-JWTë¥¼-ì´ìš©í•˜ì—¬-Auth-êµ¬í˜„í•˜ê¸°-3/">Passportì™€ JWTë¥¼ ì´ìš©í•˜ì—¬ Auth êµ¬í˜„í•˜ê¸°[3]</a> - (client) ì†Œì…œë¡œê·¸ì¸</li>
  <li><a href="/study/rnative/Passportì™€-JWTë¥¼-ì´ìš©í•˜ì—¬-Auth-êµ¬í˜„í•˜ê¸°-4/">Passportì™€ JWTë¥¼ ì´ìš©í•˜ì—¬ Auth êµ¬í˜„í•˜ê¸°[4]</a> - (server) JWT ìœ íš¨ì„± ê²€ì‚¬</li>
</ul>

<h2 id="ìì²´-íšŒì›ê°€ì…-ë¡œê·¸ì¸-ë°-jwt">ìì²´ íšŒì›ê°€ì…, ë¡œê·¸ì¸ ë° JWT</h2>

<h3 id="passport-ì„¤ì¹˜">Passport ì„¤ì¹˜</h3>

<p>PassportëŠ” ê° SNSë³„ ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ íŒ¨í‚¤ì§€í™”í•´ì„œ ì œê³µí•˜ë¯€ë¡œ, <code class="highlighter-rouge">passport</code>ì™€ ì›í•˜ëŠ” íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ ì£¼ë©´ ë˜ëŠ”ë°, ì´ë²ˆ í¬ìŠ¤íŒ…ì€ local ë¡œê·¸ì¸ì— ê´€í•œ ë‚´ìš©ì„ ë‹¤ë£° ê²ƒì´ë¯€ë¡œ, <code class="highlighter-rouge">passport</code>ì™€ <code class="highlighter-rouge">passport-local</code>ì„ ì„¤ì¹˜í•œë‹¤. ë˜í•œ, JWT êµ¬í˜„ì„ ìœ„í•´ <code class="highlighter-rouge">jsonwebtoken</code>ë„ ì„¤ì¹˜í•œë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>yarn add passport passport-local jsonwebtoken
</code></pre></div></div>

<h3 id="appjs-ì‘ì„±">app.js ì‘ì„±</h3>

<p>app.js íŒŒì¼ì— ì‘ì„±í•  passport ëª¨ë“ˆì„ importí•˜ê³ , <code class="highlighter-rouge">/users</code> ë¼ìš°í„°ë¥¼ ì‘ì„±í•œë‹¤.
â€˜</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./module/passport</span><span class="dl">"</span><span class="p">);</span>
<span class="p">...</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">"</span><span class="s2">/users</span><span class="dl">"</span><span class="p">,</span> <span class="nx">usersRouter</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">app</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="users-ë¼ìš°í„°-ì‘ì„±">users ë¼ìš°í„° ì‘ì„±</h3>

<p>ë¨¼ì €, ìì²´ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ APIëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">ë©”ì„œë“œ</th>
      <th style="text-align: center">ì—”ë“œí¬ì¸íŠ¸</th>
      <th style="text-align: center">ì—­í• </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">POST</td>
      <td style="text-align: center"><code class="highlighter-rouge">/users/signup</code></td>
      <td style="text-align: center">íšŒì›ê°€ì…</td>
    </tr>
    <tr>
      <td style="text-align: center">POST</td>
      <td style="text-align: center"><code class="highlighter-rouge">/users/signin</code></td>
      <td style="text-align: center">ë¡œê·¸ì¸</td>
    </tr>
  </tbody>
</table>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">controllers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../controllers</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/signup</span><span class="dl">"</span><span class="p">,</span> <span class="nx">controllers</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">signup</span><span class="p">.</span><span class="nx">post</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/signin</span><span class="dl">"</span><span class="p">,</span> <span class="nx">controllers</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">signin</span><span class="p">.</span><span class="nx">post</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="users-ì»¨íŠ¸ë¡¤ëŸ¬-ì‘ì„±">users ì»¨íŠ¸ë¡¤ëŸ¬ ì‘ì„±</h3>

<p>passport ë¯¸ë“¤ì›¨ì–´ëŠ” <code class="highlighter-rouge">passport.authenticate(passport ë¯¸ë“¤ì›¨ì–´ ì´ë¦„, callback)</code>ë¥¼ í†µí•´ ì‚¬ìš©í•œë‹¤. passport ë¯¸ë“¤ì›¨ì–´ ì‹¤í–‰ê²°ê³¼ <code class="highlighter-rouge">(err, user, info*)</code>ê°€ callback í•¨ìˆ˜ë¡œ ë„˜ì–´ì˜¤ê¸° ë•Œë¬¸ì—, ì–´ë–¤ ì‘ì—…ì„ ìˆ˜í–‰í• ì§€ ì •ì˜í•´ì£¼ë©´ ëœë‹¤.</p>

<p>ë˜í•œ, sessionì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°, <code class="highlighter-rouge">{ session: false }</code>ë¥¼ <code class="highlighter-rouge">passport.authenticate()</code>ì˜ ì¸ìë¡œ ë„˜ê²¨ì£¼ì–´ì•¼ í•œë‹¤. signin ì‹œ, â€œlocal_loginâ€ì´ë¼ëŠ” íŒ¨ìŠ¤í¬íŠ¸ ë¯¸ë“¤ì›¨ì–´ë¥¼ í†µí•´ ìœ íš¨í•œ ìœ ì €ì¸ì§€ í™•ì¸ì´ ë˜ê³  ë‚˜ë©´, tokenì„ ìƒì„±í•˜ì—¬ clientë¡œ ë³´ë‚´ì£¼ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">jwt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">jsonwebtoken</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">signup</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">post</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">passport</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">register</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">{</span> <span class="na">session</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
        <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.</span><span class="dl">"</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">ì •ìƒì ìœ¼ë¡œ íšŒì›ê°€ì… ë˜ì—ˆìŠµë‹ˆë‹¤.</span><span class="dl">"</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">)(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">signin</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">post</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">passport</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span>
        <span class="dl">"</span><span class="s2">local_login</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">{</span> <span class="na">session</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
        <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
              <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</span><span class="dl">"</span><span class="p">,</span>
              <span class="na">success</span><span class="p">:</span> <span class="kc">false</span>
            <span class="p">});</span>
          <span class="p">}</span>
          <span class="nx">req</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="p">{</span> <span class="na">session</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">jwt</span><span class="p">.</span><span class="nx">sign</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span> <span class="p">},</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">JWT_SECRET</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">userToken</span><span class="p">:</span> <span class="nx">token</span><span class="p">,</span> <span class="na">success</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">)(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="module-í´ë”-ë‚´-passportjs-ì‘ì„±">module í´ë” ë‚´ passport.js ì‘ì„±</h3>

<p>module ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ê³ , passport.js íŒŒì¼ì„ ë§Œë“ ë‹¤.</p>

<p>ê¸°ë³¸ì ìœ¼ë¡œ <code class="highlighter-rouge">passport.use(ë¯¸ë“¤ì›¨ì–´ ì´ë¦„, Strategy)</code> í˜•íƒœë¡œ ì‘ì„±í•´ì£¼ë©´ ë˜ëŠ”ë°, local ê³„ì •ìœ¼ë¡œ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‘ì„±í•˜ê³  ìˆê¸° ë•Œë¬¸ì—, <code class="highlighter-rouge">new LocalStrategy()</code>ë¥¼ ì‚¬ìš©í•œë‹¤. passportì˜ LocalStrategyëŠ” <code class="highlighter-rouge">usernameField</code> <code class="highlighter-rouge">email</code>ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— <code class="highlighter-rouge">req</code>ì— ë‹´ê²¨ì˜¨ ì¶”ê°€ì ì¸ ì •ë³´ë¥¼ ë¯¸ë“¤ì›¨ì–´ ë‚´ì—ì„œ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ <code class="highlighter-rouge">passReqToCallback: true</code>ë¼ëŠ” ì†ì„±ì„ ì¶”ê°€í•´ ì¤€ë‹¤.</p>

<p>íšŒì›ê°€ì… ì‹œ, ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥í•˜ì˜€ê¸° ë•Œë¬¸ì—, ì €ì¥ëœ ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ì™€, ì…ë ¥ëœ ë¹„ë°€ë²ˆí˜¸ì˜ ì•”í˜¸í™” ê°’ì´ ê°™ì€ì§€ë¥¼ í™•ì¸í•˜ëŠ” ë‚´ìš©ì„ ì¶”ê°€í•˜ì˜€ë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">passport</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">passport</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">LocalStrategy</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">passport-local</span><span class="dl">"</span><span class="p">).</span><span class="nx">Strategy</span><span class="p">;</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">Users</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../models</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">passport</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">register</span><span class="dl">"</span><span class="p">,</span>
  <span class="k">new</span> <span class="nx">LocalStrategy</span><span class="p">(</span>
    <span class="p">{</span>
      <span class="na">usernameField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">passwordField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">pw</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">passReqToCallback</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">Users</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">email</span> <span class="p">}</span> <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="p">{</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Already registered!</span><span class="dl">"</span> <span class="p">});</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">encryptedPw</span> <span class="o">=</span> <span class="nx">crypto</span>
              <span class="p">.</span><span class="nx">createHash</span><span class="p">(</span><span class="dl">"</span><span class="s2">sha1</span><span class="dl">"</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>
            <span class="nx">Users</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
              <span class="na">name</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
              <span class="na">email</span><span class="p">:</span> <span class="nx">email</span><span class="p">,</span>
              <span class="na">pw</span><span class="p">:</span> <span class="nx">encryptedPw</span><span class="p">,</span>
              <span class="na">provider</span><span class="p">:</span> <span class="dl">"</span><span class="s2">local</span><span class="dl">"</span>
            <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="p">{</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Successfully registered!</span><span class="dl">"</span> <span class="p">});</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">)</span>
<span class="p">);</span>

<span class="nx">passport</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">local_login</span><span class="dl">"</span><span class="p">,</span>
  <span class="k">new</span> <span class="nx">LocalStrategy</span><span class="p">(</span>
    <span class="p">{</span>
      <span class="na">usernameField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">passwordField</span><span class="p">:</span> <span class="dl">"</span><span class="s2">pw</span><span class="dl">"</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">encryptedPw</span> <span class="o">=</span> <span class="nx">crypto</span>
        <span class="p">.</span><span class="nx">createHash</span><span class="p">(</span><span class="dl">"</span><span class="s2">sha1</span><span class="dl">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">password</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">Users</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="nx">email</span> <span class="p">}</span> <span class="p">})</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span> <span class="o">||</span> <span class="nx">user</span><span class="p">.</span><span class="nx">dataValues</span><span class="p">.</span><span class="nx">pw</span> <span class="o">!==</span> <span class="nx">encryptedPw</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="p">{</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Incorrect email or password.</span><span class="dl">"</span> <span class="p">});</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="p">{</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Logged In Successfully</span><span class="dl">"</span> <span class="p">});</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="kc">false</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p><br />
<span class="reference">ê´€ë ¨ post</span></p>

<ul>
  <li><a href="/study/nodejs/Passportì™€-JWTë¥¼-ì´ìš©í•˜ì—¬-Auth-êµ¬í˜„í•˜ê¸°-2/">Passportì™€ JWTë¥¼ ì´ìš©í•˜ì—¬ Auth êµ¬í˜„í•˜ê¸°[2]</a></li>
  <li><a href="/study/rnative/Passportì™€-JWTë¥¼-ì´ìš©í•˜ì—¬-Auth-êµ¬í˜„í•˜ê¸°-3/">Passportì™€ JWTë¥¼ ì´ìš©í•˜ì—¬ Auth êµ¬í˜„í•˜ê¸°[3]</a></li>
  <li><a href="/study/rnative/Passportì™€-JWTë¥¼-ì´ìš©í•˜ì—¬-Auth-êµ¬í˜„í•˜ê¸°-4/">Passportì™€ JWTë¥¼ ì´ìš©í•˜ì—¬ Auth êµ¬í˜„í•˜ê¸°[4]</a></li>
</ul>
:ET