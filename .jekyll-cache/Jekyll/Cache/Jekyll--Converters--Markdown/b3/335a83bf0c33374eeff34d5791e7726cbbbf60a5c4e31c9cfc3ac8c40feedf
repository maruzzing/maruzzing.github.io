I"×=<p>ì—¬íƒœ í† ì´ í”„ë¡œì íŠ¸ ì´ê±´, íšŒì‚¬ í”„ë¡œì íŠ¸ ì´ê±´ Rest API ë§Œ ì‚¬ìš©í–ˆì—ˆëŠ”ë°, ì§€ê¸ˆ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê³µìœ  ì˜¤í”¼ìŠ¤ì—ì„œ ì•Œê²Œ ëœ ë°±ì—”ë“œ ê°œë°œìê°€ Reactì™€ GraphQL ì‚¬ìš©ë²•ì„ ë¬¼ì–´ì™€ ê´€ë ¨ë‚´ìš©ì„ ì¢€ ì°¾ì•„ë³´ë‹ˆ ë„ˆë¬´ ì‹ ì„¸ê³„ë¼ğŸ‘€ ì´ì°¸ì— GraphQLì„ ê³µë¶€í•´ ë³´ê¸°ë¡œ í–ˆë‹¤.</p>

<p>ì‚¬ìš©í•  ê¸°ìˆ  ìŠ¤íƒì€ ì•„ë˜ì™€ ê°™ë‹¤.</p>
<ul>
  <li>Node.js + Express.js</li>
  <li>Typescript</li>
  <li>GraphQL</li>
  <li>Apollo Server</li>
  <li>MySQL</li>
  <li>Sequelize</li>
</ul>

<p><br />
ë¨¼ì € ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” ê°„ë‹¨í•œ ì„œë²„ êµ¬ì¶•ì„ í•´ë³´ë ¤ í•œë‹¤.</p>

<h1 id="í”„ë¡œì íŠ¸-ìƒì„±-ë°-íƒ€ì…ìŠ¤í¬ë¦½íŠ¸-ì„¤ì •í•˜ê¸°">í”„ë¡œì íŠ¸ ìƒì„± ë° íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •í•˜ê¸°</h1>

<h2 id="í”„ë¡œì íŠ¸-ìƒì„±">í”„ë¡œì íŠ¸ ìƒì„±</h2>

<p>ë¨¼ì €, ì›í•˜ëŠ” ìœ„ì¹˜ì— ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ê³  ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•œë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir</span> <span class="o">[</span>í”„ë¡œì íŠ¸ ì´ë¦„]
<span class="nv">$ </span><span class="nb">cd</span> <span class="o">[</span>í”„ë¡œì íŠ¸ ì´ë¦„]
<span class="nv">$ </span>npm init <span class="nt">--yes</span>
</code></pre></div></div>

<h2 id="íƒ€ì…ìŠ¤í¬ë¦½íŠ¸-ì„¤ì •">íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •</h2>

<p>íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì™€ nodemon, ê·¸ë¦¬ê³  ts-nodeë¥¼ ì„¤ì¹˜í•´ ì£¼ê³ , ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— <code class="highlighter-rouge">tsconfig.json</code> íŒŒì¼ì„ ìƒì„±í•œë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm i typescript nodemon ts-node <span class="nt">--save-dev</span>
</code></pre></div></div>

<p>ìƒì„±ëœ <code class="highlighter-rouge">tsconfig.json</code> íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•´ ì¤€ë‹¤.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"compilerOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"es6"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"module"</span><span class="p">:</span><span class="w"> </span><span class="s2">"commonjs"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"lib"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"dom"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"es6"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"outDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dist"</span><span class="p">,</span><span class="w">         
      </span><span class="nl">"rootDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"src"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"moduleResolution"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"strict"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"esModuleInterop"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">                     
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"exclude"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"node_modules"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"include"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"./src/**/*.tsx"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"./src/**/*.ts"</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h1 id="expressì—-graphql-api-ì ìš©í•˜ê¸°">Expressì— GraphQL API ì ìš©í•˜ê¸°</h1>

<p>ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ì„œë²„ë¥¼ ìƒì„±í•´ ë³¼ ì°¨ë¡€.</p>

<h2 id="ë””íœë˜ì‹œ-ì„¤ì¹˜">ë””íœë˜ì‹œ ì„¤ì¹˜</h2>

<p>í•„ìš”í•œ ë””íœë˜ì‹œì™€ ì´ì™¸ ê´€ë ¨ëœ type íŒ¨í‚¤ì§€ë“¤ë„ ì„¤ì¹˜í•´ ì¤€ë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm i apollo-server-express express graphql
<span class="nv">$ </span>npm i cors compression morgan dotenv
</code></pre></div></div>

<h2 id="ê¸°ë³¸-express-ì„œë²„-ìƒì„±í•˜ê¸°">ê¸°ë³¸ express ì„œë²„ ìƒì„±í•˜ê¸°</h2>

<p>ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— src í´ë”ë¥¼ ìƒì„±í•˜ê³  <code class="highlighter-rouge">server.ts</code> íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•´ ì¤€ë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">express</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">cors</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">morgan</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">morgan</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">compression</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">compression</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">dotenv</span><span class="p">.</span><span class="nx">config</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">prod</span><span class="p">:</span> <span class="nx">boolean</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">prod</span> <span class="p">?</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="p">:</span> <span class="mi">8000</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">morgan</span><span class="p">(</span><span class="dl">'</span><span class="s1">dev</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">compression</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">():</span> <span class="k">void</span> <span class="o">=&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
    <span class="s2">`\nğŸš€      GraphQL is now running on http://localhost:</span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">/graphql`</span><span class="p">,</span>
  <span class="p">),</span>
<span class="p">);</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">package.json</code>ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•˜ê³  <code class="highlighter-rouge">npm run dev</code>ë¥¼ ì‹¤í–‰í•˜ë©´ ì •ìƒì ìœ¼ë¡œ ì„œë²„ê°€ êµ¬ë™ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span><span class="w">
  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nodemon 'src/server.ts' --exec 'ts-node' src/server.ts -e ts"</span><span class="w">
  </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<h2 id="graphql-schemaì™€-resolver-ì •ì˜í•˜ê¸°">GraphQL schemaì™€ resolver ì •ì˜í•˜ê¸°</h2>

<p><a href="https://github.com/graphql/express-graphql#simple-setup">express-graphql</a> ë¬¸ì„œì— ë”°ë¥´ë©´ graphql http ì„œë²„ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ì„œëŠ” schema ì •ì˜ê°€ í•„ìš”í•˜ë‹¤. schemaëŠ” <a href="https://github.com/graphql/graphql-js">graphql-js</a>ì˜ <code class="highlighter-rouge">GraphQLSchema</code> ì¸ìŠ¤í„´ìŠ¤ë¡œ <a href="https://github.com/ardatan/graphql-tools">graphql-tools</a>ë¥¼ ì‚¬ìš©í•´ ì‰½ê²Œ ì •ì˜í•  ìˆ˜ ìˆë‹¤.</p>

<p><img src="/images/express-graphql-simple-setup.png" alt="express-graphql-simple-setup" title="express-graphql-simple-setup" /></p>

<p>ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— schema.ts íŒŒì¼ì„ ë§Œë“¤ê³  ì•„ë˜ì™€ ê°™ì´ schemaë¥¼ ì •ì˜í•œë‹¤. GraphQLì˜ ì¿¼ë¦¬ê°€ ê°€ëŠ¥í•œ íƒ€ì… ì •ì˜(typeDefs)ì™€ ì¿¼ë¦¬ë¥¼ ìš”ì²­í–ˆì„ ë•Œ ì„œë²„ê°€ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ë¥¼ ì •ì˜í•œ ë¦¬ì¡¸ë²„(resolvers)ë¡œ êµ¬ì„±ëœë‹¤.</p>

<p>GraphQLì˜ íƒ€ì… ì •ì˜ ë°©ì‹ì€ <a href="https://graphql.org/learn/schema/">ì—¬ê¸°</a>ì„œ ìì„¸í•˜ê²Œ ì•Œì•„ë³¼ ìˆ˜ ìˆë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">makeExecutableSchema</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@graphql-tools/schema</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">IResolvers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">graphql-tools</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">GraphQLSchema</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">graphql</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">typeDefs</span> <span class="o">=</span> <span class="s2">`
  type Query {
    ping: String!
}`</span>

<span class="kd">const</span> <span class="nx">resolverMap</span><span class="p">:</span> <span class="nx">IResolvers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">Query</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">ping</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s2">`ğŸ‘‹ pong! ğŸ‘‹`</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="na">schema</span><span class="p">:</span> <span class="nx">GraphQLSchema</span> <span class="o">=</span> <span class="nx">makeExecutableSchema</span><span class="p">({</span>
  <span class="nx">typeDefs</span><span class="p">,</span>
  <span class="nx">resolvers</span><span class="p">,</span>
<span class="p">});</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">schema</span><span class="p">;</span>
</code></pre></div></div>
<p>ì´ì œ ì •ì˜í•œ schemaë¥¼ ì´ìš©í•´ graphql ì„œë²„ë¥¼ ì ìš©í•  ì°¨ë¡€ì´ë‹¤. <code class="highlighter-rouge">server.ts</code> íŒŒì¼ë¡œ ëŒì•„ê°€ ì•„ë˜ì™€ ê°™ì´ <code class="highlighter-rouge">/graphql</code> ì—”ë“œí¬ì¸íŠ¸ì— <code class="highlighter-rouge">graphqlHTTP</code> ì„œë²„ë¥¼ ìƒì„±í•´ ì¤€ë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span>
<span class="k">import</span> <span class="nx">schema</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./schema</span><span class="dl">'</span><span class="p">;</span>
<span class="p">...</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">morgan</span><span class="p">(</span><span class="dl">'</span><span class="s1">dev</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">compression</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>
  <span class="dl">'</span><span class="s1">/graphql</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">graphqlHTTP</span><span class="p">({</span>
    <span class="nx">schema</span><span class="p">,</span>
    <span class="na">graphiql</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">}),</span>
<span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">():</span> <span class="k">void</span> <span class="o">=&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
    <span class="s2">`\nğŸš€      GraphQL is now running on http://localhost:</span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">/graphql`</span><span class="p">,</span>
  <span class="p">),</span>
<span class="p">);</span>
</code></pre></div></div>

<h2 id="í…ŒìŠ¤íŠ¸-í•´ë³´ê¸°">í…ŒìŠ¤íŠ¸ í•´ë³´ê¸°</h2>

<p>ì´ì œ ì œëŒ€ë¡œ êµ¬ì¶•ì´ ë˜ì—ˆëŠ”ì§€ ì¿¼ë¦¬ë¥¼ ë³´ë‚´ë³´ì. ì½˜ì†”ì— ì•„ë˜ì˜¤ ê°™ì´ curl ëª…ë ¹ì–´ë¥¼ ì „ì†¡í•˜ë©´ ì‘ë‹µì´ ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-X</span> POST <span class="s2">"http://localhost:8000/graphql"</span> <span class="nt">-H</span> <span class="s2">"content-type: application/json"</span> <span class="nt">-d</span> <span class="s1">'{"query":"{ping}"}'</span> 

<span class="o">{</span><span class="s2">"data"</span>:<span class="o">{</span><span class="s2">"ping"</span>:<span class="s2">"ğŸ‘‹ pong! ğŸ‘‹"</span><span class="o">}}</span>
</code></pre></div></div>
<p><br /></p>

<p>ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ postmanì„ í™œìš©í•´ì„œë„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
<img src="/images/express-graphql-simple-setup-test.png" alt="express-graphql-simple-setup-test" title="express-graphql-simple-setup-test" /></p>
:ET